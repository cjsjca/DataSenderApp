<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Brain Input</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 10px;
            background: #1a1a1a;
            color: #fff;
            margin: 0;
        }
        #input {
            width: 100%;
            height: 60vh;
            font-size: 18px;
            padding: 15px;
            border: none;
            border-radius: 8px;
            background: #2a2a2a;
            color: #fff;
            box-sizing: border-box;
            resize: none;
        }
        #input:focus {
            outline: 2px solid #007AFF;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        button {
            flex: 1;
            padding: 20px;
            font-size: 18px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        button:active {
            background: #0051D5;
        }
        #status {
            margin-top: 10px;
            text-align: center;
            font-size: 14px;
            color: #888;
            min-height: 20px;
        }
        #stream {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            background: #2a2a2a;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            color: #aaa;
        }
        .entry {
            margin-bottom: 5px;
            opacity: 0.8;
        }
        .time {
            color: #666;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <textarea id="input" placeholder="Just type... anything, anytime, any format" autofocus></textarea>
    
    <div class="controls">
        <button onclick="send()">Send</button>
        <button onclick="sendAndClear()">Send + Clear</button>
    </div>
    
    <div id="status"></div>
    <div id="stream"></div>
    
    <script>
    const SUPABASE_URL = 'https://xvxyzmldrqewigrrccea.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2eHl6bWxkcnFld2lncnJjY2VhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3ODY0NDUsImV4cCI6MjA2ODM2MjQ0NX0.Y6F9a-L6VUdxPdUTNZTBNvAqTWwR6i2R-ACsoZZPxyE';
    
    let sending = false;
    
    async function send() {
        if (sending) return;
        
        const text = document.getElementById('input').value.trim();
        if (!text) return;
        
        sending = true;
        document.getElementById('status').textContent = '↑ sending...';
        
        const data = {
            content: text
        };
        
        try {
            const response = await fetch(`${SUPABASE_URL}/rest/v1/texts`, {
                method: 'POST',
                headers: {
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Content-Type': 'application/json',
                    'Prefer': 'return=representation'
                },
                body: JSON.stringify(data)
            });
            
            if (response.ok) {
                const result = await response.json();
                document.getElementById('status').textContent = '✓ sent';
                addToStream(text);
                
                // Backend can process this now:
                // - Send to LLM for understanding
                // - Extract entities/topics
                // - Generate embeddings
                // - Route to appropriate services
            } else {
                document.getElementById('status').textContent = '✗ failed';
            }
        } catch (error) {
            document.getElementById('status').textContent = '✗ error';
        }
        
        sending = false;
        setTimeout(() => {
            document.getElementById('status').textContent = '';
        }, 2000);
    }
    
    function sendAndClear() {
        send();
        setTimeout(() => {
            document.getElementById('input').value = '';
            document.getElementById('input').focus();
        }, 100);
    }
    
    function addToStream(text) {
        const stream = document.getElementById('stream');
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
        const preview = text.length > 50 ? text.substring(0, 50) + '...' : text;
        
        stream.innerHTML = `<div class="entry"><span class="time">${time}</span> ${preview}</div>` + stream.innerHTML;
        
        // Keep only last 10 entries
        const entries = stream.getElementsByClassName('entry');
        while (entries.length > 10) {
            entries[entries.length - 1].remove();
        }
    }
    
    // Keyboard shortcuts
    document.getElementById('input').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && e.metaKey) { // Cmd+Enter to send
            e.preventDefault();
            sendAndClear();
        }
    });
    
    // Auto-save draft
    setInterval(() => {
        const text = document.getElementById('input').value;
        if (text) {
            localStorage.setItem('brain_draft', text);
        }
    }, 5000);
    
    // Restore draft
    window.onload = () => {
        const draft = localStorage.getItem('brain_draft');
        if (draft) {
            document.getElementById('input').value = draft;
        }
    };
    </script>
</body>
</html>