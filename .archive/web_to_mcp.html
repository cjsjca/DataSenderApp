<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>MCP Chat Bridge</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 20px;
            background: #000;
            color: #fff;
            margin: 0;
            max-width: 600px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #007AFF;
        }
        
        #status {
            text-align: center;
            padding: 10px;
            background: #111;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .connected { color: #4CAF50; }
        .error { color: #F44336; }
        
        textarea {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #1c1c1e;
            color: #fff;
            resize: vertical;
            min-height: 100px;
            box-sizing: border-box;
        }
        
        button {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        #messages {
            background: #111;
            padding: 20px;
            border-radius: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .message {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            background: #1c1c1e;
        }
        
        .instructions {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <h1>MCP Chat Bridge</h1>
    
    <div class="instructions">
        <strong>How to use:</strong><br>
        1. Make sure MCP server is running<br>
        2. Type message below<br>
        3. In Claude CLI, use: <code>mcp_call chat-bridge get_messages</code><br>
        4. Claude can respond with: <code>mcp_call chat-bridge send_response</code>
    </div>
    
    <div id="status">Connecting to MCP bridge...</div>
    
    <textarea id="message" placeholder="Type message for Claude..." autofocus></textarea>
    <button onclick="sendMessage()">Send to MCP Server</button>
    
    <div id="messages">
        <h3>Message History</h3>
        <div id="message-list"></div>
    </div>
    
    <script>
    const MCP_URL = 'http://localhost:3000';
    
    async function checkConnection() {
        try {
            const response = await fetch(MCP_URL + '/send', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: '' })
            });
            
            if (response.ok || response.status === 400) {
                document.getElementById('status').textContent = '✓ Connected to MCP Server';
                document.getElementById('status').className = 'connected';
                return true;
            }
        } catch (e) {
            document.getElementById('status').textContent = '✗ MCP Server not running';
            document.getElementById('status').className = 'error';
        }
        return false;
    }
    
    async function sendMessage() {
        const textarea = document.getElementById('message');
        const message = textarea.value.trim();
        if (!message) return;
        
        try {
            const response = await fetch(MCP_URL + '/send', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message })
            });
            
            if (response.ok) {
                const result = await response.json();
                addToHistory(message, result.id);
                textarea.value = '';
                
                document.getElementById('status').textContent = '✓ Message sent! Use get_messages in Claude';
                document.getElementById('status').className = 'connected';
            } else {
                throw new Error('Failed to send');
            }
        } catch (error) {
            document.getElementById('status').textContent = '✗ Error sending message';
            document.getElementById('status').className = 'error';
        }
    }
    
    function addToHistory(message, id) {
        const messageList = document.getElementById('message-list');
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message';
        messageDiv.innerHTML = `
            <strong>Message #${id}</strong> (${time})<br>
            ${message}
        `;
        
        messageList.insertBefore(messageDiv, messageList.firstChild);
    }
    
    // Check connection on load
    window.addEventListener('load', () => {
        checkConnection();
        // Check every 5 seconds
        setInterval(checkConnection, 5000);
    });
    
    // Enter to send
    document.getElementById('message').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });
    </script>
</body>
</html>